---
title: "time series"
output: html_notebook
---
Prediction of future movement patterns of stock prices has been a widely researched area in the literature. While there are proponents of the efficient market hypothesis who believe that it is impossible to predict stock prices, there are also propositions that demonstrated that if correctly formulated and modeled, prediction of stock prices can be done with a fairly high level of accuracy. The latter school of thought focused on the construction of robust statistical, econometric and machine learning models based on the careful choice of variables and appropriate functional forms or models of forecasting. There propositions in the literature that are based on time series analysis and decomposition for forecasting future values of stocks.

The literature attempting to prove or disprove the efficient market hypothesis can be classified into three strands, according to the choice of variables and techniques of estimation and forecasting. The first strand consists of studies using simple regression techniques on cross-sectional data. The second strand of the literature has used time series models and techniques to forecast stock returns following economic tools like autoregressive integrated moving average (ARIMA), Granger causality test, autoregressive distributed lag (ARDL) and quantile regression (QR) to forecast stock prices. The third strand includes work using machine learning tools for the prediction of stock returns.


```{r}
library(PerformanceAnalytics)
library(quantmod)
library(tidyverse)
library(modeldata)
library(forecast)
library(tidymodels)
library(modeltime)
library(timetk)
library(lubridate)
```


```{r}
BTC <- getSymbols("BTC-USD", src = "yahoo", from = "2013-01-01", to = "2020-11-01", auto.assign = FALSE)

Op(BTC)
Cl(BTC)
Hi(BTC)
Lo(BTC)
Vo(BTC)
```


```{r}
plot(dailyReturn(BTC))

plot(weeklyReturn(BTC))

ts=as.data.frame(dailyReturn(BTC))
ts$date=as.Date (row.names(ts)) 
```

```{r}
train_data <- training(initial_time_split(ts, prop = .8))
test_data <- testing(initial_time_split(ts, prop = .8))

```

```{r}
train_data %>% mutate(type = "train") %>% 
  bind_rows(test_data %>% mutate(type = "test")) %>% 
  ggplot(aes(x = date, y =daily.returns, color = type)) + 
  geom_line()
```


```{r}
arima_model <- arima_reg() %>% 
  set_engine("auto_arima") %>% 
  fit(daily.returns~date, data = train_data)
```



```{r}
prophet_model <- prophet_reg() %>% 
  set_engine("prophet") %>% 
  fit(daily.returns~date, data = train_data)
```


```{r}
tslm_model <- linear_reg() %>% 
  set_engine("lm") %>% 
  fit(daily.returns~as.numeric(date) + factor(month(date, label = TRUE)), data = train_data)

```


```{r}
forecast_table <- modeltime_table(
  arima_model,
  prophet_model,
  tslm_model
  #,arima_boosted_model
)
```



```{r}
forecast_table %>% 
  modeltime_calibrate(test_data) %>% 
  modeltime_accuracy()
```



```{r}
forecast_table %>% 
  modeltime_calibrate(test_data) %>% 
  modeltime_forecast(actual_data = test_data) %>% 
  plot_modeltime_forecast()
```

